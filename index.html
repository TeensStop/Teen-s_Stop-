<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teen's Stop - Your Ultimate Drink Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* NSLForge.com Inspired Redesign */
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap');

        :root {
            --primary-dark: #0A0A0A; /* Near black background */
            --secondary-dark: #141414; /* Slightly lighter for cards/elements */
            --accent-green: #00FF99; /* Vibrant neon green */
            --accent-green-darker: #00D17E;
            --text-main: #EAEAEA;    /* Light grey for main text */
            --text-secondary: #888888;   /* Muted grey for secondary text */
            --border-color: rgba(0, 255, 153, 0.2); /* Subtle green border */
            --glow-shadow: 0 0 15px rgba(0, 255, 153, 0.2), 0 0 25px rgba(0, 255, 153, 0.1);
            --border-radius-sharp: 4px;
            --spacing-unit: 1rem;
        }

        /* --- Base & Body --- */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: var(--primary-dark);
            color: var(--text-main);
            line-height: 1.6;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 16px;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 calc(var(--spacing-unit) * 1.5);
            box-sizing: border-box;
        }

        /* --- Typography --- */
        h1, h2, h3, .store-name {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        /* --- Header & Navigation --- */
        header {
            background-color: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: calc(var(--spacing-unit) * 1.2) 0;
            position: sticky;
            top: 0;
            z-index: 500;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .store-name {
            font-size: 1.8rem;
            color: var(--text-main);
        }

        .store-name span {
            color: var(--accent-green);
        }

        .search-bar {
            flex-grow: 1;
            max-width: 500px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: calc(var(--spacing-unit) * 0.7) calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 0.7) calc(var(--spacing-unit) * 2.8);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sharp);
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--secondary-dark);
            color: var(--text-main);
            box-sizing: border-box;
        }

        .search-bar input:focus {
            border-color: var(--accent-green);
            box-shadow: var(--glow-shadow);
        }

        .search-bar i {
            position: absolute;
            left: var(--spacing-unit);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .cart-button {
            background-color: transparent;
            color: var(--accent-green);
            padding: calc(var(--spacing-unit) * 0.7) calc(var(--spacing-unit) * 1.5);
            border: 1px solid var(--accent-green);
            border-radius: var(--border-radius-sharp);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            position: relative;
            display: flex;
            align-items: center;
            gap: calc(var(--spacing-unit) * 0.5);
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        .cart-button:hover {
            background-color: var(--accent-green);
            color: var(--primary-dark);
            box-shadow: var(--glow-shadow);
        }

        #cart-count {
            background-color: var(--accent-green);
            color: var(--primary-dark);
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 0.75rem;
            font-weight: 700;
            min-width: 24px;
            text-align: center;
            line-height: 1;
        }

        /* --- Hero Section --- */
        .hero {
            text-align: center;
            padding: calc(var(--spacing-unit) * 6) 0;
            background-color: var(--primary-dark);
            border: 1px solid var(--border-color);
            margin-top: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius-sharp);
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(0, 255, 153, 0.1), transparent 30%),
                radial-gradient(circle at 85% 30%, rgba(0, 255, 153, 0.1), transparent 30%);
            opacity: 0.5;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 900px;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: var(--spacing-unit);
            color: var(--text-main);
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.3);
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto calc(var(--spacing-unit) * 2.5);
        }

        .hero .shop-now-btn {
            background-color: var(--accent-green);
            color: var(--primary-dark);
            padding: calc(var(--spacing-unit) * 0.9) calc(var(--spacing-unit) * 2.2);
            border: none;
            border-radius: var(--border-radius-sharp);
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 255, 153, 0.3), 0 0 25px rgba(0, 255, 153, 0.2);
            transition: transform 0.2s ease, box-shadow 0.3s ease;
        }

        .hero .shop-now-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 25px rgba(0, 255, 153, 0.5), 0 0 40px rgba(0, 255, 153, 0.3);
        }

        /* --- Section Titles --- */
        .section-title {
            font-size: 2rem;
            margin-bottom: calc(var(--spacing-unit) * 2.5);
            position: relative;
            text-align: center;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 2px;
            background-color: var(--accent-green);
            box-shadow: 0 0 5px var(--accent-green);
        }

        /* --- Category & Product Grids --- */
        .category-overview, .product-category {
            margin-top: calc(var(--spacing-unit) * 5);
        }

        .category-grid, .product-grid {
            display: grid;
            gap: calc(var(--spacing-unit) * 1.5);
        }

        .category-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .product-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }
        
        /* --- Card Styling --- */
        .category-card, .product-card {
            background-color: var(--secondary-dark);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sharp);
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        .category-card:hover, .product-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-green);
            box-shadow: var(--glow-shadow);
        }

        .category-card {
            padding: calc(var(--spacing-unit) * 2);
            text-align: center;
            cursor: pointer;
        }

        .category-card i {
            font-size: 3rem;
            color: var(--accent-green);
            margin-bottom: var(--spacing-unit);
            text-shadow: 0 0 10px var(--accent-green);
        }

        .category-card h3 {
            font-size: 1rem;
            margin: 0;
            color: var(--text-main);
        }

        /* Product Card Specifics */
        .product-card {
            display: flex;
            flex-direction: column;
        }
        
        .product-image-container {
            width: 100%;
            height: 220px;
            overflow: hidden;
            background-color: #000;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }
        
        .product-info {
            padding: calc(var(--spacing-unit) * 1);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-family: 'Roboto', sans-serif;
            text-transform: none;
            letter-spacing: 0;
            font-size: 1.1rem;
            font-weight: 500;
            margin: 0 0 calc(var(--spacing-unit) * 0.5);
            color: var(--text-main);
            flex-grow: 1;
            line-height: 1.4;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-green);
            margin: calc(var(--spacing-unit) * 0.5) 0;
        }

        .product-price .mrp {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-decoration: line-through;
            font-weight: 400;
            margin-left: 10px;
        }
        
        .add-to-cart-btn {
            background-color: transparent;
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
            padding: calc(var(--spacing-unit) * 0.6);
            width: 100%;
            border-radius: var(--border-radius-sharp);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            margin-top: auto;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .add-to-cart-btn:hover {
            background-color: var(--accent-green);
            color: var(--primary-dark);
            box-shadow: var(--glow-shadow);
        }

        .add-to-cart-btn:disabled {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
            background-color: transparent;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* --- Modal Styles --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s forwards;
        }

        .modal-content {
            background-color: var(--secondary-dark);
            margin: 5vh auto;
            padding: calc(var(--spacing-unit) * 2);
            border-radius: var(--border-radius-sharp);
            border: 1px solid var(--border-color);
            width: 95%;
            max-width: 750px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), var(--glow-shadow);
            animation: slideInFromTop 0.4s ease-out forwards;
        }

        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        @keyframes slideInFromTop { from {transform: translateY(-50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        .close-button {
            color: var(--text-secondary);
            position: absolute;
            top: var(--spacing-unit);
            right: calc(var(--spacing-unit) * 1.5);
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s ease, text-shadow 0.2s ease;
        }

        .close-button:hover, .close-button:focus {
            color: var(--accent-green);
            text-shadow: 0 0 10px var(--accent-green);
        }

        .modal-content h2 {
            color: var(--accent-green);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-unit);
        }

        /* Cart & Checkout Form */
        #cart-items {
            list-style: none;
            padding: 0;
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: var(--spacing-unit);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sharp);
        }
        
        #cart-items::-webkit-scrollbar { width: 8px; }
        #cart-items::-webkit-scrollbar-track { background: var(--secondary-dark); }
        #cart-items::-webkit-scrollbar-thumb { background-color: var(--accent-green); border-radius: 4px; border: 2px solid var(--secondary-dark); }


        #cart-items li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: calc(var(--spacing-unit) * 1);
            border-bottom: 1px solid var(--border-color);
        }

        #cart-items li:last-child { border-bottom: none; }
        
        .quantity-btn {
            background-color: transparent;
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
            border-radius: 50%;
            width: 28px; height: 28px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            transition: all 0.2s ease;
        }
        .quantity-btn:hover { background-color: var(--accent-green); color: var(--primary-dark); }

        #cart-total-container {
            text-align: right;
            font-size: 1.5rem;
            font-weight: 700;
            margin: var(--spacing-unit) 0;
        }
        #cart-total { color: var(--accent-green); }

        /* Form elements */
        #checkout-form label, #payment-options label {
            display: block;
            margin-top: var(--spacing-unit);
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }
        
        #checkout-form input[type="text"],
        #checkout-form input[type="tel"],
        #checkout-form textarea,
        .coupon-section input[type="text"] {
            width: 100%;
            padding: calc(var(--spacing-unit) * 0.7);
            border-radius: var(--border-radius-sharp);
            border: 1px solid var(--border-color);
            box-sizing: border-box;
            font-size: 1rem;
            background-color: var(--secondary-dark);
            color: var(--text-main);
            transition: all 0.3s ease;
        }
        
        #checkout-form input:focus,
        #checkout-form textarea:focus,
        .coupon-section input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: var(--glow-shadow);
        }
        
        .coupon-section { margin: 1.5rem 0; display: flex; gap: 10px; }
        .coupon-section button {
             background-color: var(--accent-green); color: var(--primary-dark); border: none; padding: calc(var(--spacing-unit) * 0.7); border-radius: var(--border-radius-sharp); cursor: pointer; font-weight: 700; text-transform: uppercase; font-family: 'Space Mono', monospace;
        }
        #coupon-message.success { color: var(--accent-green); }
        #coupon-message.error { color: #E74C3C; }

        #upi-qr-code {
            display: block; text-align: center; margin-top: 1.5rem; padding: 1rem; border: 1px dashed var(--accent-green); border-radius: var(--border-radius-sharp);
        }
        #upi-qr-code img { max-width: 200px; height: auto; border-radius: var(--border-radius-sharp); filter: invert(1) hue-rotate(180deg); }
        #upi-qr-code strong { color: var(--accent-green); }
        
        #checkout-form button[type="submit"] {
            margin-top: 1.5rem; width: 100%; background-color: var(--accent-green); color: var(--primary-dark);
        }
        
        /* --- Footer --- */
        footer {
            background-color: var(--secondary-dark);
            color: var(--text-secondary);
            padding: calc(var(--spacing-unit) * 2.5) 0;
            text-align: center;
            margin-top: calc(var(--spacing-unit) * 4);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-color);
        }

        /* --- Scratch Card Specific Styles --- */
        .scratch-card-modal-content { text-align: center; }
        .scratch-card-container {
            position: relative; width: 300px; height: 180px; margin: 1.5rem auto; border-radius: var(--border-radius-sharp);
            overflow: hidden;
            background: linear-gradient(45deg, var(--secondary-dark), #222);
            border: 1px solid var(--accent-green);
            box-shadow: var(--glow-shadow);
            display: flex; align-items: center; justify-content: center;
        }

        .scratch-card-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; cursor: cell; }
        .scratch-card-reveal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1; color: var(--accent-green);
            font-size: 1.6rem; font-family: 'Space Mono', monospace;
        }
        .claim-gift-btn {
            background-color: var(--accent-green); color: var(--primary-dark); border: none;
            padding: 14px 25px; border-radius: var(--border-radius-sharp); font-size: 1rem;
            font-family: 'Space Mono', monospace; text-transform: uppercase; cursor: pointer; margin-top: 1.5rem;
        }
        .claim-gift-btn:disabled { background-color: var(--text-secondary); cursor: not-allowed; }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .hero h1 { font-size: 2.8rem; }
            .product-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
        }

        @media (max-width: 768px) {
            header .container { flex-wrap: wrap; justify-content: center; gap: var(--spacing-unit); }
            .search-bar { order: 3; width: 100%; max-width: none; margin-top: var(--spacing-unit); }
            .hero h1 { font-size: 2.2rem; }
            .hero p { font-size: 1rem; }
            .product-grid { grid-template-columns: repeat(2, 1fr); }
            .category-grid { grid-template-columns: repeat(2, 1fr); }
            .modal-content { padding: 1.5rem; }
            #cart-items li { flex-wrap: wrap; gap: 10px; }
        }

        @media (max-width: 480px) {
            .store-name { font-size: 1.5rem; }
            .hero { padding: 4rem 0; }
            .hero h1 { font-size: 1.8rem; }
            .section-title { font-size: 1.5rem; }
        }

    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="store-name">Teen's<span>Stop</span></div>
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Search for drinks...">
            </div>
            <button class="cart-button" id="open-cart-btn">
                <i class="fas fa-shopping-cart"></i> Cart
                <span id="cart-count">0</span>
            </button>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <div class="hero-content">
                <h1>Quench Your Thirst</h1>
                <p>Your ultimate hub for the coolest Prime, Kato, and other exotic drinks in Navsari!</p>
                <button class="shop-now-btn" onclick="document.getElementById('category-overview').scrollIntoView({ behavior: 'smooth' });">Explore Drinks</button>
            </div>
        </section>

        <section id="category-overview" class="category-overview">
            <h2 class="section-title">Shop by Category</h2>
            <div class="category-grid" id="category-grid">
                <!-- Category cards will be injected here by JavaScript -->
            </div>
        </section>

        <section id="product-sections">
            <!-- Product categories and cards will be injected here by JavaScript -->
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Teen's Stop. All rights reserved.</p>
            <p>Sip, Enjoy, Repeat!</p>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-cart-btn">&times;</span>
            <h2>Your Cart</h2>
            <ul id="cart-items">
                <!-- Cart items will be injected here by JavaScript -->
            </ul>
            <div class="coupon-section">
                <input type="text" id="coupon-code-input" placeholder="Enter coupon code">
                <button id="apply-coupon-btn">Apply</button>
            </div>
            <p id="coupon-message"></p>

            <div id="cart-total-container">
                Total: ‚Çπ<span id="cart-total">0.00</span>
                <p id="discount-applied" style="display:none; font-size: 0.9rem; color: var(--text-secondary)"></p>
            </div>
            <p id="delivery-charge" style="font-size: 0.9rem; color: var(--text-secondary); text-align: right;">Delivery Charge: ‚Çπ30.00</p>
            
            <h2 style="margin-top: 2rem;">Checkout</h2>
            <form id="checkout-form" action="https://formsubmit.co/teensstopofficial@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="üéâ New Order from Teen's Stop!">
                <input type="hidden" name="_template" value="table">
                <textarea name="Order_Summary" id="order-summary" readonly style="display:none;"></textarea>

                <label for="name">Full Name</label>
                <input type="text" id="name" name="Customer_Name" required>

                <label for="address">Full Delivery Address</label>
                <textarea id="address" name="Delivery_Address" rows="3" required></textarea>

                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="Phone_Number" required>

                <label>Payment Method</label>
                <div id="payment-options">
                     <input type="radio" id="upi" name="Payment_Method" value="UPI" checked style="display:none;">
                     <label for="upi" style="text-transform:none; font-family: 'Roboto', sans-serif; font-size: 1rem; color: var(--text-main);"><i class="fas fa-qrcode"></i> UPI Payment</label>
                </div>

                <div id="upi-qr-code">
                    <p>Scan the QR code with any UPI app to pay.</p>
                    <img src="https://placehold.co/220x220/00FF99/0A0A0A?text=UPI+QR" alt="UPI QR Code">
                    <p><strong>Note:</strong> Show the payment receipt to the delivery person.</p>
                </div>

                <button type="submit" class="add-to-cart-btn" style="width:100%; font-size: 1.1rem; padding: 1rem;">Place Order</button>
            </form>
        </div>
    </div>

    <!-- Scratch Card Modal -->
    <div id="scratch-card-modal" class="modal">
        <div class="modal-content scratch-card-modal-content">
            <span class="close-button" id="close-scratch-card-btn">&times;</span>
            <h2>Congratulations!</h2>
            <p style="color: var(--text-secondary);">Scratch the card to reveal your surprise gift!</p>
            <div class="scratch-card-container">
                <canvas id="scratch-canvas" class="scratch-card-canvas"></canvas>
                <div class="scratch-card-reveal" id="scratch-card-reveal">
                    <span class="gift-emoji" style="font-size: 3rem;">üéÅ</span>
                    <p>A Surprise Gift!</p>
                </div>
            </div>
            <button class="claim-gift-btn" id="claim-gift-btn" disabled>Claim Gift</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
             // --- YOUR PRODUCT DATA ---
            const products = [
                // Prime Energy Drinks (Assumed MRP)
                { id: 101, name: 'Prime Energy (Ice Pop)', price: 349, mrp: 399, image: 'https://placehold.co/400x400/87CEEB/white?text=Prime+Ice+Pop', category: 'Prime Energy Drinks' },
                { id: 102, name: 'Prime Energy (Blue Raspberry)', price: 349, mrp: 399, image: 'https://placehold.co/400x400/0000FF/white?text=Prime+Blue+Raspberry', category: 'Prime Energy Drinks' },
                { id: 103, name: 'Prime Energy (Orange Mango)', price: 349, mrp: 399, image: 'https://placehold.co/400x400/FFA500/white?text=Prime+Orange+Mango', category: 'Prime Energy Drinks' },
                { id: 104, name: 'Prime Energy (Tropical Punch)', price: 349, mrp: 399, image: 'https://placehold.co/400x400/FF6347/white?text=Prime+Tropical+Punch', category: 'Prime Energy Drinks' },
                { id: 105, name: 'Prime Energy (Lemon Lime)', price: 349, mrp: 399, image: 'https://placehold.co/400x400/9ACD32/white?text=Prime+Lemon+Lime', category: 'Prime Energy Drinks' },

                // Prime Hydration Drinks (Assumed MRP)
                { id: 201, name: 'Prime Hydration (Meta Moon)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/9b59b6/white?text=Prime+Meta+Moon', category: 'Prime Hydration Drinks' },
                { id: 202, name: 'Prime Hydration (Blue Raspberry)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/0000CD/white?text=Prime+Blue+Raspberry', category: 'Prime Hydration Drinks' },
                { id: 203, name: 'Prime Hydration (Tropical Punch)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/FF4500/white?text=Prime+Tropical+Punch', category: 'Prime Hydration Drinks' },
                { id: 204, name: 'Prime Hydration (Lemon Lime)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/ADFF2F/white?text=Prime+Lemon+Lime', category: 'Prime Hydration Drinks' },
                { id: 205, name: 'Prime Hydration (Grape)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/800080/white?text=Prime+Grape', category: 'Prime Hydration Drinks' },
                { id: 206, name: 'Prime Hydration (Orange)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/FF8C00/white?text=Prime+Orange', category: 'Prime Hydration Drinks' },
                { id: 207, name: 'Prime Hydration (Strawberry Watermelon)', price: 299, mrp: 349, image: 'https://placehold.co/400x400/FF69B4/white?text=Prime+Strawberry+Watermelon', category: 'Prime Hydration Drinks' },

                // Prime Drinks (Limited Editions)
                { id: 501, name: 'Prime FC Barcelona', price: 600, mrp: 650, image: 'https://placehold.co/400x400/A50044/white?text=Prime+FCB', category: 'Limited Edition Prime' },
                { id: 502, name: 'Prime Berry Freeze', price: 600, mrp: 650, image: 'https://placehold.co/400x400/8A2BE2/white?text=Prime+Berry+Freeze', category: 'Limited Edition Prime' },
                { id: 503, name: 'Prime Glow Berry', price: 600, mrp: 650, image: 'https://placehold.co/400x400/F0F8FF/black?text=Prime+Glow+Berry', category: 'Limited Edition Prime' },
                { id: 504, name: 'Prime Arsenal', price: 600, mrp: 650, image: 'https://placehold.co/400x400/EF0107/white?text=Prime+Arsenal', category: 'Limited Edition Prime' },
                { id: 505, name: 'Prime IShowSpeed', price: 600, mrp: 650, image: 'https://placehold.co/400x400/FFD700/black?text=Prime+IShowSpeed', category: 'Limited Edition Prime' },
                { id: 506, name: 'Prime Strawberry Banana', price: 599, mrp: 649, image: 'https://placehold.co/400x400/FFC0CB/white?text=Prime+Strawberry+Banana', category: 'Limited Edition Prime' },


                // Kato Drinks (Assumed MRP)
                { id: 301, name: 'Kato Sparkling Water (Grape)', price: 80, mrp: 90, image: 'https://placehold.co/400x400/BEB2D6/black?text=Kato+Grape', category: 'Kato Drinks' },
                { id: 302, name: 'Kato Sparkling Water (Peach)', price: 80, mrp: 90, image: 'https://placehold.co/400x400/FFDAB9/black?text=Kato+Peach', category: 'Kato Drinks' },
                { id: 303, name: 'Kato Sparkling Water (Blackcurrant)', price: 80, mrp: 90, image: 'https://placehold.co/400x400/4B0082/white?text=Kato+Blackcurrant', category: 'Kato Drinks' },
                { id: 304, name: 'Kato Sparkling Water (Strawberry)', price: 80, mrp: 90, image: 'https://placehold.co/400x400/FF69B4/black?text=Kato+Strawberry', category: 'Kato Drinks' },
                { id: 305, name: 'Kato Sparkling Water (Lychee)', price: 80, mrp: 90, image: 'https://placehold.co/400x400/F0FFF0/black?text=Kato+Lychee', category: 'Kato Drinks' },
                { id: 306, name: 'Kato Coconut Water (Original)', price: 120, mrp: 135, image: 'https://placehold.co/400x400/F0E68C/black?text=Kato+Coconut', category: 'Kato Drinks' },
                { id: 307, name: 'Kato Coconut Water (Pineapple)', price: 120, mrp: 135, image: 'https://placehold.co/400x400/FFD700/black?text=Kato+Pineapple', category: 'Kato Drinks' },
                
                // Trident Chewing Gum (10% OFF MRP)
                { id: 601, name: 'Trident Spearmint Gum', price: 179, mrp: 199, image: 'https://placehold.co/400x400/9FE2BF/black?text=Trident+Spearmint', category: 'Trident Chewing Gum' },
                { id: 602, name: 'Trident Original Flavor Gum', price: 179, mrp: 199, image: 'https://placehold.co/400x400/4169E1/white?text=Trident+Original', category: 'Trident Chewing Gum' },
                { id: 603, name: 'Trident Watermelon Twist Gum', price: 179, mrp: 199, image: 'https://placehold.co/400x400/FC6C85/white?text=Trident+Watermelon', category: 'Trident Chewing Gum' },
                { id: 604, name: 'Trident Tropical Twist Gum', price: 179, mrp: 199, image: 'https://placehold.co/400x400/FFD700/black?text=Trident+Tropical', category: 'Trident Chewing Gum' },
                { id: 605, name: 'Trident Cinnamon Gum', price: 179, mrp: 199, image: 'https://placehold.co/400x400/C41E3A/white?text=Trident+Cinnamon', category: 'Trident Chewing Gum' },
                { id: 606, name: 'Trident Mint Bliss Gum', price: 179, mrp: 199, image: 'https://placehold.co/400x400/50C878/white?text=Trident+Mint+Bliss', category: 'Trident Chewing Gum' },

                // Other Beverages
                { id: 1101, name: 'Vanilla Coca-Cola', price: 269, mrp: 290, image: 'https://placehold.co/400x400/F5F5DC/black?text=Vanilla+Coke', category: 'Other Beverages' },
                { id: 1102, name: 'Coca-Cola Lemon Soft Drink', price: 277, mrp: 300, image: 'https://placehold.co/400x400/FFFF00/black?text=Coke+Lemon', category: 'Other Beverages' },
                { id: 1103, name: 'Bar Ice Cream Soda', price: 277, mrp: 300, image: 'https://placehold.co/400x400/B0E0E6/black?text=Bar+Ice+Cream+Soda', category: 'Other Beverages' },
                { id: 1104, name: 'Starbucks Creamy Coffee', price: 379, mrp: 400, image: 'https://placehold.co/400x400/8B4513/white?text=Starbucks+Creamy+Coffee', category: 'Other Beverages' },
                { id: 1105, name: 'American Style Basil Seed Watermelon Drink', price: 149, mrp: 160, image: 'https://placehold.co/400x400/FF6347/white?text=Basil+Seed+Watermelon', category: 'Other Beverages' },
                { id: 1106, name: 'American Style Basil Seed Kiwi Drink', price: 149, mrp: 160, image: 'https://placehold.co/400x400/8A2BE2/white?text=Basil+Seed+Kiwi', category: 'Other Beverages' },
                { id: 401, name: 'Zero Alcohol Vodka', price: 299, mrp: 350, image: 'https://placehold.co/400x400/A9A9A9/white?text=Zero+Alcohol+Vodka', category: 'Other Beverages' },
                { id: 408, name: 'White Monster Energy', price: 149, mrp: 160, image: 'https://placehold.co/400x400/FFFFFF/black?text=White+Monster', category: 'Other Beverages' },
                { id: 409, name: 'Golden Red Bull', price: 399, mrp: 450, image: 'https://placehold.co/400x400/FFD700/black?text=Golden+Red+Bull', category: 'Other Beverages' },
                { id: 411, name: 'Swami Sparkling Water', price: 149, mrp: 160, image: 'https://placehold.co/400x400/D3D3D3/black?text=Swami+Sparkling', category: 'Other Beverages' },
                { id: 412, name: 'Starbucks Coffee (Caramel)', price: 379, mrp: 400, image: 'https://placehold.co/400x400/8B4513/white?text=Starbucks+Caramel', category: 'Other Beverages' },
                { id: 403, name: "Jimmy's Cocktail (Green Apple)", price: 159, mrp: 180, image: 'https://placehold.co/400x400/98FB98/black?text=Jimmy%27s+Green+Apple', category: 'Other Beverages' },
                { id: 10001, name: 'Mystery Box', price: 649, mrp: 699, image: 'https://placehold.co/400x400/8B008B/white?text=Mystery+Box', category: 'Other Beverages' },

                // New Products Added Here:
                { id: 2001, name: 'Nongshim Shin Ramyun Toomba RAMEN (Spicy & Creamy)', price: 399, mrp: 450, image: 'https://placehold.co/400x400/8B0000/white?text=Shin+Ramyun', category: 'Noodles & Snacks' },
                { id: 2002, name: 'Doritos International Cool Ranch Nachos', price: 179, mrp: 200, image: 'https://placehold.co/400x400/4682B4/white?text=Doritos+Cool+Ranch', category: 'Noodles & Snacks' },
                { id: 2003, name: 'Mexican Salsa', price: 120, mrp: 135, image: 'https://placehold.co/400x400/FF4500/white?text=Mexican+Salsa', category: 'Noodles & Snacks' },
                { id: 2004, name: 'RED BULL YELLOW LIMITED EDITION TROPICAL FLAVOUR', price: 279, mrp: 300, image: 'https://placehold.co/400x400/FFD700/black?text=Red+Bull+Tropical', category: 'Other Beverages' },
                { id: 2005, name: 'RED BULL SUGAR FREE', price: 209, mrp: 230, image: 'https://placehold.co/400x400/FFFFFF/black?text=Red+Bull+Sugar+Free', category: 'Other Beverages' },
                { id: 2006, name: 'Flemish Champagne (Blue)', price: 299, mrp: 330, image: 'https://placehold.co/400x400/0000FF/white?text=Flemish+Champagne+Blue', category: 'Other Beverages' },
                { id: 2007, name: 'Flemish Champagne (Pink)', price: 299, mrp: 330, image: 'https://placehold.co/400x400/FFC0CB/black?text=Flemish+Champagne+Pink', category: 'Other Beverages' },
                { id: 2008, name: 'IMPANCT MINTS GHIBLI STYLE (India Gate)', price: 179, mrp: 200, image: 'https://placehold.co/400x400/8B0000/white?text=Ghibli+Mint+India+Gate', category: 'Mints & Chocolates' },
                { id: 2009, name: 'IMPANCT MINTS GHIBLI STYLE (Elephant)', price: 179, mrp: 200, image: 'https://placehold.co/400x400/663399/white?text=Ghibli+Mint+Elephant', category: 'Mints & Chocolates' },
                { id: 2010, name: 'POPPING BOBA (200 GMS)', price: 249, mrp: 270, image: 'https://placehold.co/400x400/FF69B4/white?text=Popping+Boba', category: 'Other Beverages' },


                // Candies & Chewing Gums
                { id: 402, name: 'Skittles Pack of 20 (MX Player)', price: 799, mrp: 850, image: 'https://placehold.co/400x400/FF0000/white?text=Skittles+20+Pack', category: 'Candies & Chewing Gums' },
                { id: 405, name: 'Skittles (Purple)', price: 149, mrp: 160, image: 'https://placehold.co/400x400/800080/white?text=Skittles+Purple', category: 'Candies & Chewing Gums' },
                { id: 406, name: 'Skittles (Red)', price: 149, mrp: 160, image: 'https://placehold.co/400x400/FF0000/white?text=Skittles+Red', category: 'Candies & Chewing Gums' },
                { id: 407, name: 'Ice Breakers Chewing Gum', price: 749, mrp: 800, image: 'https://placehold.co/400x400/ADD8E6/black?text=Ice+Breakers', category: 'Candies & Chewing Gums' },
                { id: 415, name: 'Poko Loko Bubble Tape', price: 259, mrp: 280, image: 'https://placehold.co/400x400/FFC0CB/black?text=Poko+Loko+Bubble+Tape', category: 'Candies & Chewing Gums' },
                { id: 701, name: 'Fusen Berry (Chewing Gum)', price: 199, mrp: 220, image: 'https://placehold.co/400x400/C71585/white?text=Fusen+Berry', category: 'Candies & Chewing Gums' },
                { id: 702, name: 'Banana (Chewing Gum)', price: 199, mrp: 220, image: 'https://placehold.co/400x400/FFD700/black?text=Banana+Gum', category: 'Candies & Chewing Gums' },
                { id: 703, name: 'Mint (Chewing Gum)', price: 199, mrp: 220, image: 'https://placehold.co/400x400/98FB98/black?text=Mint+Gum', category: 'Candies & Chewing Gums' },
                { id: 704, name: 'Impact Mint Candies Cricket Limited Edition (Peppermint)', price: 99, mrp: 110, image: 'https://placehold.co/400x400/66CDAA/white?text=Impact+Mint', category: 'Candies & Chewing Gums' },
                { id: 705, name: 'Impactment Strike Chewing Gum (Spearmint Flavor)', price: 149, mrp: 160, image: 'https://placehold.co/400x400/7FFFD4/black?text=Impact+Spearmint', category: 'Candies & Chewing Gums' },
                { id: 801, name: 'Poko Loko Troffecho Strawberry Flavor', price: 249, mrp: 270, image: 'https://placehold.co/400x400/FFC0CB/black?text=Poko+Loko+Strawberry+Troffecho', category: 'Candies & Chewing Gums' },
                { id: 802, name: 'Poko Loko Mix Fruit Flavor Candy', price: 199, mrp: 220, image: 'https://placehold.co/400x400/F0F8FF/black?text=Poko+Loko+Mix+Fruit', category: 'Candies & Chewing Gums' },
                { id: 803, name: 'Poko Loko Strawberry Sour Tape Candy', price: 99, mrp: 110, image: 'https://placehold.co/400x400/FF69B4/black?text=Poko+Loko+Sour+Tape', category: 'Candies & Chewing Gums' },
                { id: 804, name: 'Poko Loko Truti Fruit (Grape)', price: 149, mrp: 160, image: 'https://placehold.co/400x400/800080/white?text=Poko+Loko+Truti+Grape', category: 'Candies & Chewing Gums' },
                { id: 805, name: 'Poko Loko Truti Fruit (Strawberry)', price: 149, mrp: 160, image: 'https://placehold.co/400x400/FF69B4/black?text=Poko+Loko+Truti+Strawberry', category: 'Candies & Chewing Gums' },
                { id: 901, name: 'Blueberry Candy Stick', price: 79, mrp: 90, image: 'https://placehold.co/400x400/4682B4/white?text=Blueberry+Stick', category: 'Candies & Chewing Gums' },
                { id: 902, name: 'Sour Punk Rainbow Candy', price: 79, mrp: 90, image: 'https://placehold.co/400x400/FF1493/white?text=Sour+Punk+Rainbow', category: 'Candies & Chewing Gums' },
                { id: 903, name: 'Sour Punk Cola Flavor', price: 79, mrp: 90, image: 'https://placehold.co/400x400/D2B48C/black?text=Sour+Punk+Cola', category: 'Candies & Chewing Gums' },
                { id: 904, name: 'Fox Crystal Clear Berry Flavour Candy', price: 149, mrp: 160, image: 'https://placehold.co/400x400/8A2BE2/white?text=Fox+Berry+Candy', category: 'Candies & Chewing Gums' },
                { id: 905, name: 'Mix Fruit Candy (Pack of 20)', price: 149, mrp: 160, image: 'https://placehold.co/400x400/FFC0CB/black?text=Mix+Fruit+20+Pack', category: 'Candies & Chewing Gums' },

                // Mints & Chocolates
                { id: 1001, name: 'Americana Grapefruit Sugar Free Mints', price: 199, mrp: 220, image: 'https://placehold.co/400x400/FF7F50/white?text=Americana+Grapefruit', category: 'Mints & Chocolates' },
                { id: 1002, name: 'Americana Peach Sugar Free Mints', price: 199, mrp: 220, image: 'https://placehold.co/400x400/FFDAB9/black?text=Americana+Peach', category: 'Mints & Chocolates' },
                { id: 1003, name: 'Americana Passion Fruit Sugar Free Mints', price: 199, mrp: 220, image: 'https://placehold.co/400x400/FFD700/black?text=Americana+Passion+Fruit', category: 'Mints & Chocolates' },
                { id: 1201, name: 'Toblerone Dark Chocolate Flavor', price: 399, mrp: 430, image: 'https://placehold.co/400x400/2F4F4F/white?text=Toblerone+Dark', category: 'Mints & Chocolates' },
                { id: 404, name: 'Maltesers', price: 149, mrp: 165, image: 'https://placehold.co/400x400/8B4513/white?text=Maltesers', category: 'Mints & Chocolates' },
                { id: 410, name: 'Feastables', price: 599, mrp: 650, image: 'https://placehold.co/400x400/A0522D/white?text=Feastables', category: 'Mints & Chocolates' },
                { id: 413, name: 'Hello Panda (Strawberry)', price: 169, mrp: 180, image: 'https://placehold.co/400x400/FFB6C1/black?text=Hello+Panda+Strawberry', category: 'Mints & Chocolates' },
                { id: 414, name: 'Hello Panda (Chocolate)', price: 169, mrp: 180, image: 'https://placehold.co/400x400/D2B48C/black?text=Hello+Panda+Chocolate', category: 'Mints & Chocolates' }
            ];

            const DELIVERY_CHARGE = 30;
            const SCRATCH_CARD_THRESHOLD = 499;
            const SURPRISE_GIFT_ID = 99999;

            // DOM Elements
            const productSectionsContainer = document.getElementById('product-sections');
            const categoryGrid = document.getElementById('category-grid');
            const cartButton = document.getElementById('open-cart-btn');
            const cartModal = document.getElementById('cart-modal');
            const closeCartButton = document.getElementById('close-cart-btn');
            const cartItemsList = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotalSpan = document.getElementById('cart-total');
            const orderSummaryTextarea = document.getElementById('order-summary');
            const couponCodeInput = document.getElementById('coupon-code-input');
            const applyCouponBtn = document.getElementById('apply-coupon-btn');
            const couponMessage = document.getElementById('coupon-message');
            const discountAppliedMessage = document.getElementById('discount-applied');
            const deliveryChargeDisplay = document.getElementById('delivery-charge');
            const searchInput = document.getElementById('search-input');

            // Scratch Card DOM
            const scratchCardModal = document.getElementById('scratch-card-modal');
            const closeScratchCardBtn = document.getElementById('close-scratch-card-btn');
            const scratchCanvas = document.getElementById('scratch-canvas');
            const claimGiftBtn = document.getElementById('claim-gift-btn');

            let ctx, isScratching = false, revealedPixels = 0;
            let scratchThreshold = 0.5;
            let hasWonScratchCard = false;

            // State
            let cart = JSON.parse(localStorage.getItem('teensStopCartV2')) || [];
            let currentDiscount = 0;
            let appliedCouponCode = '';

            // Core Functions
            function getUniqueCategories() {
                const categoryOrder = [
                    'Prime Energy Drinks', 'Prime Hydration Drinks', 'Limited Edition Prime', 'Kato Drinks',
                    'Other Beverages', 'Noodles & Snacks', 'Mints & Chocolates', 'Candies & Chewing Gums', 'Trident Chewing Gum'
                ];
                const categories = new Set(products.map(p => p.category));
                return categoryOrder.filter(cat => categories.has(cat));
            }

            function getCategoryIcon(categoryName) {
                const icons = {
                    'Prime Energy Drinks': 'fa-bolt', 'Prime Hydration Drinks': 'fa-bottle-water',
                    'Limited Edition Prime': 'fa-star', 'Kato Drinks': 'fa-wine-glass-alt',
                    'Other Beverages': 'fa-mug-hot', 'Noodles & Snacks': 'fa-bowl-food',
                    'Mints & Chocolates': 'fa-stroopwafel', 'Candies & Chewing Gums': 'fa-candy-cane',
                    'Trident Chewing Gum': 'fa-leaf'
                };
                return icons[categoryName] || 'fa-cube';
            }

            function renderCategoryCards() {
                categoryGrid.innerHTML = '';
                const categories = getUniqueCategories();
                categories.forEach(category => {
                    const categoryCard = document.createElement('div');
                    categoryCard.className = 'category-card';
                    categoryCard.setAttribute('data-category', category);
                    categoryCard.innerHTML = `
                        <i class="fas ${getCategoryIcon(category)}"></i>
                        <h3>${category}</h3>
                    `;
                    categoryGrid.appendChild(categoryCard);
                    categoryCard.addEventListener('click', () => {
                        const targetSection = document.getElementById(`category-${category.replace(/\s+/g, '-').toLowerCase()}`);
                        if (targetSection) targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    });
                });
            }

            function renderProducts(filterText = '') {
                productSectionsContainer.innerHTML = '';
                const lowerFilterText = filterText.toLowerCase();

                const groupedProducts = products.reduce((acc, product) => {
                    if (product.name.toLowerCase().includes(lowerFilterText)) {
                        if (!acc[product.category]) acc[product.category] = [];
                        acc[product.category].push(product);
                    }
                    return acc;
                }, {});

                getUniqueCategories().forEach(category => {
                    if (!groupedProducts[category] || groupedProducts[category].length === 0) return;

                    const categorySection = document.createElement('div');
                    categorySection.className = 'product-category';
                    categorySection.id = `category-${category.replace(/\s+/g, '-').toLowerCase()}`;
                    categorySection.innerHTML = `<h2 class="section-title">${category}</h2><div class="product-grid"></div>`;
                    productSectionsContainer.appendChild(categorySection);

                    const productGrid = categorySection.querySelector('.product-grid');
                    groupedProducts[category].forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        let priceHtml = `<p class="product-price">‚Çπ${product.price.toFixed(2)}`;
                        if (product.mrp && product.price < product.mrp) {
                            priceHtml += `<span class="mrp">‚Çπ${product.mrp.toFixed(2)}</span>`;
                        }
                        priceHtml += `</p>`;
                        
                        productCard.innerHTML = `
                            <div class="product-image-container">
                                <img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.src='https://placehold.co/400x400/141414/888888?text=Image+Not+Found'">
                            </div>
                            <div class="product-info">
                                <h3 class="product-name">${product.name}</h3>
                                ${priceHtml}
                                <button class="add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                            </div>
                        `;
                        productGrid.appendChild(productCard);
                    });
                });
            }

            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                const cartItem = cart.find(item => item.id === productId);
                if (cartItem) cartItem.quantity++;
                else cart.push({ ...product, quantity: 1 });
                updateCart();
            }

            function updateQuantity(productId, change) {
                const cartItem = cart.find(item => item.id === productId);
                if (!cartItem) return;

                if (cartItem.id === SURPRISE_GIFT_ID && (cartItem.quantity + change) < 1) return;
                
                cartItem.quantity += change;
                if (cartItem.quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }
                updateCart();
            }

            function updateCart() {
                renderCartItems();
                updateCartUI();
                localStorage.setItem('teensStopCartV2', JSON.stringify(cart));
                checkForScratchCardWin();
                checkAndRemoveGift();
            }
            
            function renderCartItems() {
                cartItemsList.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsList.innerHTML = '<li style="justify-content: center; color: var(--text-secondary);">Your cart is empty.</li>';
                    return;
                }
                cart.forEach(item => {
                    const li = document.createElement('li');
                    const isGift = item.id === SURPRISE_GIFT_ID;
                    const quantityControls = isGift ? `<span>Qty: ${item.quantity} (Gift)</span>` : `
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <button class="quantity-btn decrease-quantity-btn" data-id="${item.id}">-</button>
                            <span>${item.quantity}</span>
                            <button class="quantity-btn increase-quantity-btn" data-id="${item.id}">+</button>
                        </div>`;
                    const priceDisplay = isGift ? `<span style="color: var(--accent-green);">FREE</span>` : `<span>‚Çπ${(item.price * item.quantity).toFixed(2)}</span>`;
                    
                    li.innerHTML = `
                        <span style="flex-grow: 1;">${item.name}</span>
                        ${quantityControls}
                        ${priceDisplay}
                    `;
                    cartItemsList.appendChild(li);
                });
            }

            function calculateSubtotal() {
                return cart.reduce((sum, item) => item.id === SURPRISE_GIFT_ID ? sum : sum + item.price * item.quantity, 0);
            }

            function updateCartUI() {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                
                const subtotal = calculateSubtotal();
                let total = subtotal;

                if (currentDiscount > 0) {
                    total *= (1 - (currentDiscount / 100));
                }

                if (subtotal > 0) {
                    total += DELIVERY_CHARGE;
                }

                cartTotalSpan.textContent = total.toFixed(2);
                deliveryChargeDisplay.style.display = subtotal > 0 ? 'block' : 'none';
                
                if(appliedCouponCode) {
                    discountAppliedMessage.textContent = `(Applied: ${appliedCouponCode} - ${currentDiscount}% OFF)`;
                    discountAppliedMessage.style.display = 'block';
                } else {
                    discountAppliedMessage.style.display = 'none';
                }

                updateOrderSummaryForForm(subtotal, total);
            }

            function updateOrderSummaryForForm(subtotal, finalTotal) {
                let summary = 'Order Details:\n';
                cart.forEach(item => {
                    const price = item.id === SURPRISE_GIFT_ID ? 'FREE' : `‚Çπ${(item.price * item.quantity).toFixed(2)}`;
                    summary += `- ${item.name} (Qty: ${item.quantity}) - ${price}\n`;
                });
                summary += `\nSubtotal: ‚Çπ${subtotal.toFixed(2)}`;
                if (appliedCouponCode) summary += `\nCoupon Applied: ${appliedCouponCode} (${currentDiscount}% OFF)`;
                if (subtotal > 0) summary += `\nDelivery Charge: ‚Çπ${DELIVERY_CHARGE.toFixed(2)}`;
                summary += `\nGRAND TOTAL: ‚Çπ${finalTotal.toFixed(2)}`;
                orderSummaryTextarea.value = summary;
            }

            function applyCoupon() {
                const couponCode = couponCodeInput.value.trim().toUpperCase();
                currentDiscount = 0;
                appliedCouponCode = '';
                couponMessage.textContent = '';
                couponMessage.className = '';

                if (cart.length === 0) {
                    couponMessage.textContent = 'Cart is empty.';
                    couponMessage.classList.add('error');
                    return;
                }

                if (couponCode === 'DARSHIL15' || couponCode === 'SPECIALFRND') {
                    currentDiscount = 15;
                    appliedCouponCode = couponCode;
                    couponMessage.textContent = `Success! 15% discount applied.`;
                    couponMessage.classList.add('success');
                } else {
                    couponMessage.textContent = 'Invalid coupon code.';
                    couponMessage.classList.add('error');
                }
                updateCartUI();
            }
            
            // Scratch Card Logic
            function checkForScratchCardWin() {
                const subtotal = calculateSubtotal();
                const hasGiftAlready = cart.some(item => item.id === SURPRISE_GIFT_ID);
                if (subtotal >= SCRATCH_CARD_THRESHOLD && !hasWonScratchCard && !hasGiftAlready) {
                    hasWonScratchCard = true;
                    showScratchCardModal();
                } else if (subtotal < SCRATCH_CARD_THRESHOLD && hasWonScratchCard && !hasGiftAlready) {
                    hasWonScratchCard = false;
                }
            }
            
            function checkAndRemoveGift() {
                const giftInCart = cart.find(item => item.id === SURPRISE_GIFT_ID);
                if(giftInCart) {
                    const subtotal = calculateSubtotal();
                    if(subtotal < SCRATCH_CARD_THRESHOLD) {
                        cart = cart.filter(item => item.id !== SURPRISE_GIFT_ID);
                        hasWonScratchCard = false;
                        updateCart();
                    }
                }
            }
            
            function showScratchCardModal() {
                scratchCardModal.style.display = 'block';
                initializeScratchCard();
            }

            function initializeScratchCard() {
                const container = document.querySelector('.scratch-card-container');
                scratchCanvas.width = container.clientWidth;
                scratchCanvas.height = container.clientHeight;
                ctx = scratchCanvas.getContext('2d', { willReadFrequently: true });
                ctx.fillStyle = '#00FF99';
                ctx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 35;
                ctx.lineJoin = ctx.lineCap = 'round';
                revealedPixels = 0;
                claimGiftBtn.disabled = true;
                addScratchListeners();
            }
            
            function getEventPos(e, canvas) {
                const rect = canvas.getBoundingClientRect();
                const evt = e.touches ? e.touches[0] : e;
                return { x: evt.clientX - rect.left, y: evt.clientY - rect.top };
            }

            function startScratching(e) { isScratching = true; ctx.beginPath(); const pos = getEventPos(e, scratchCanvas); ctx.moveTo(pos.x, pos.y); e.preventDefault(); }
            function scratch(e) { if (!isScratching) return; const pos = getEventPos(e, scratchCanvas); ctx.lineTo(pos.x, pos.y); ctx.stroke(); checkRevealedArea(); e.preventDefault(); }
            function stopScratching() { isScratching = false; }
            
            function checkRevealedArea() {
                const imageData = ctx.getImageData(0, 0, scratchCanvas.width, scratchCanvas.height);
                let transparentPixels = 0;
                for (let i = 3; i < imageData.data.length; i += 4) {
                    if (imageData.data[i] === 0) transparentPixels++;
                }
                revealedPixels = transparentPixels / (scratchCanvas.width * scratchCanvas.height);
                if (revealedPixels >= scratchThreshold) {
                    claimGiftBtn.disabled = false;
                    removeScratchListeners();
                }
            }

            function claimSurpriseGift() {
                if (!cart.some(item => item.id === SURPRISE_GIFT_ID)) {
                    const giftProduct = { id: SURPRISE_GIFT_ID, name: 'ü•≥ Surprise Gift!', price: 0, mrp: 0, image: 'https://placehold.co/400x400/00FF99/0A0A0A?text=GIFT' };
                    cart.push({ ...giftProduct, quantity: 1 });
                    updateCart();
                }
                claimGiftBtn.disabled = true;
                scratchCardModal.style.display = 'none';
            }
            
            function addScratchListeners() { ['mousedown', 'touchstart'].forEach(evt => scratchCanvas.addEventListener(evt, startScratching)); ['mousemove', 'touchmove'].forEach(evt => scratchCanvas.addEventListener(evt, scratch)); ['mouseup', 'touchend', 'mouseleave'].forEach(evt => scratchCanvas.addEventListener(evt, stopScratching)); }
            function removeScratchListeners() { ['mousedown', 'touchstart'].forEach(evt => scratchCanvas.removeEventListener(evt, startScratching)); ['mousemove', 'touchmove'].forEach(evt => scratchCanvas.removeEventListener(evt, scratch)); ['mouseup', 'touchend', 'mouseleave'].forEach(evt => scratchCanvas.removeEventListener(evt, stopScratching)); }

            // Event Listeners
            productSectionsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    addToCart(productId);
                    e.target.innerText = 'Added!';
                    setTimeout(() => { e.target.innerText = 'Add to Cart'; }, 1000);
                }
            });

            cartItemsList.addEventListener('click', (e) => {
                const button = e.target.closest('.quantity-btn');
                if (!button) return;
                const productId = parseInt(button.dataset.id);
                if (button.classList.contains('increase-quantity-btn')) updateQuantity(productId, 1);
                else if (button.classList.contains('decrease-quantity-btn')) updateQuantity(productId, -1);
            });
            
            cartButton.addEventListener('click', () => { cartModal.style.display = 'block'; updateCartUI(); });
            closeCartButton.addEventListener('click', () => { cartModal.style.display = 'none'; });
            closeScratchCardBtn.addEventListener('click', () => { scratchCardModal.style.display = 'none'; });
            window.addEventListener('click', (e) => { if (e.target == cartModal) cartModal.style.display = 'none'; if (e.target == scratchCardModal) scratchCardModal.style.display = 'none'; });
            
            applyCouponBtn.addEventListener('click', applyCoupon);
            searchInput.addEventListener('input', (e) => renderProducts(e.target.value));
            claimGiftBtn.addEventListener('click', claimSurpriseGift);

            // Initial Load
            renderCategoryCards();
            renderProducts();
            updateCart();
        });
    </script>
</body>
</html>

